package hms.serializer;

import java.util.HashMap;
import java.util.Map;

import org.apache.poi.ss.usermodel.DataFormatter;
import org.apache.poi.ss.usermodel.Row;
import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.ss.usermodel.Workbook;

import hms.entity.user.Pharmacist;
import hms.entity.user.attributes.Gender;

public class PharmacistSerializer extends UserSerializer<Pharmacist> {
	@Override
	protected Map<String, Pharmacist> readWorkbook(Workbook wb) {
		Map<String, Pharmacist> pharmacistMap = new HashMap<String, Pharmacist>();
		for (Sheet sheet : wb) {
			for (int rowNum = 1; rowNum <= sheet.getLastRowNum(); rowNum++) {
				Pharmacist pharmacist = getPharmacistFromRow(sheet.getRow(rowNum));
				if (pharmacist != null) {
					pharmacistMap.put(pharmacist.getId(), pharmacist);
				}
			}
		}
		return pharmacistMap;
	}

	private Pharmacist getPharmacistFromRow(Row row) {
		DataFormatter formatter = new DataFormatter();
		String role = formatter.formatCellValue(row.getCell(2));
		if (role.equals("Pharmacist")) {
			String id = formatter.formatCellValue(row.getCell(0));
			String name = formatter.formatCellValue(row.getCell(1));
			Gender gender = formatter.formatCellValue(row.getCell(3)).equals("Male") ? Gender.MALE : Gender.FEMALE;
			int age = Integer.parseInt(formatter.formatCellValue(row.getCell(4)));
			return new Pharmacist(id, "password", name, gender, age);
		}
		return null;
	}
}
